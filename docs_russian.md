
## Протокол и краткая документация для KVDB

   https://github.com/genesem/kvdb

Сервер представляет собой:

## Key-value хранилище строк, списков, словарей

	TStr ItemType = iota   // строка
	TList                  // список строк. значение может быть получено по index list[0]
	TDict                  // словарь строк (aka py dict). значение может быть получено по dict['key']

Имеет:

* TTL на каждый ключ в памяти
    if TTL<=0: ключ - expired and removed автоматически.
    TTL в секундах,  поле считается как = time.Now().Unix()+TTL

* Операторы над ключами
  GET SET REMOVE KEYS (список ключей по шаблону), REMOVE KEYS (удаление нескольких ключей).

  Взаимодействие с сервером по протоколу http over tcp/ip 
  стандартный порт сервера 3000, но может быть изменён через ENV. переменную "PORT"

  В случае успеха сервер вовращает http код 200,
  если ключ не найден то 404.
  
## API взаимодействия:

*  Получить ключ `key`:

    GET /server?q=key например: `curl http://localhost:3000/?q=key1`
    успех == http код 200, ошибка 404.

    Тело ответа []byte типа: 1 символ = результат и тип значения,
                  значения типа: "+" - строка, "$" - список строк, "#" словарь, "-" error.
                  остаток( body[1:] ) декодируется функцией decode() (см. client1 package).

* Вариация get для подключа в случае list и dict (для других типов игнорируется):

    GET /server?q=key например: `curl http://localhost:3000/?q=key1?k=subkey`
    успех == http код 200, ошибка 404.

    Тело ответа []byte типа: 1 символ = результат и тип значения,
                  значения типа: "+" - строка, "$" - список строк, "#" словарь, "-" error.
                  остаток( body[1:] ) декодируется функцией decode() в нем будет строка выбранная по 
                  индексу в случае list и по ключу в случае dict.

* Удалить ключ `key`:
    DELETE /server?q=key например: `curl -X DELETE http://localhost:3000/?q=key1`
    успех == http код 200, ошибка 404.

* Удалить несколько ключей `key1,key2,key3`:
    DELETE /server?q=key например: `curl -X DELETE http://localhost:3000/?q=key1,key2,key3`
    успех == http код 200, ошибка 404.
  Про удаление ключа(ей): попытка удаления происходит в любом случае и код 200 означает,
    что ключ гарантированно не существует после вызова этой операции.


* Добавить ключ в базу данных:
    
    POST /server?q=key например: `curl -X POST -d '#DATA#' http://localhost:3000/?q=key1`
    '#DATA#' -  данные ключа в base64 закодированные фунцией encode()
    Ответ http код 200 в случае успеха, всё остальное == ошибка.
    По умолчанию ключ сохраняется с TTL = 0 (не удаляется автоматом).

    Для задания TTL в запрос добавляется параметр: 
    t=nnn (sec): POST http://localhost:3000/?q=key1&t=128 
        даёт TTL==128 секунд с момента добавления ключа key1.


* Получить список ключей по шаблону:

  Запрос: 'HEAD /server?q=patten' например: `curl -i -X head http://localhost:3000/?q=k?y?`
    Успех == http код 200, ошибка 404.
    В случае успеха возвращается список ключей (как строка) удовлетворяющих шаблону по типу операции:
    regexp.MatchString( строка ключа, шаблон ).
    Пример строки возврата: "key1,key2,key3"


NB: отладочная информация в сервере и клиентах оставлена специально.


Установка на windows:

SET GOPATH=c:\godev\kvdb  // заменить на актуальный путь
запустить build.cmd
запустить runserv.cmd // запустится сервер в новом окне.
post_client.exe - постит несколько ключей с разными ttl
get_client.exe - запрашивает несколько ключей асинхоронно.
    для стресса можно в коде get_client модифицировать цикл:
    	for ic := 0; ic < 10; ic++ { // loop to stress: 10000




           



PS. what can be improved:
    multiuser: ie each user has own db space with non intersected namespaces.
